@using System.Threading.Tasks
@model HipChatConnect.Core.Models.TeamCityConfigurationViewModel

@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Nubot Configuration</title>
    <script src="https://www.hipchat.com/atlassian-connect/all.js"></script>
    <link rel="stylesheet" href="//aui-cdn.atlassian.com/aui-adg/5.9.5/css/aui.css" media="all">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
</head>
<body>
<div>
    <div class="hipchat-config-header">You are configuring Nubot for TeamCity.</div>
</div>
<div>
    <form asp-controller="TeamCityHipChatConfigure" asp-action="Save" id="configForm" method="post">
        <div class="field-group glance-name">
            <input asp-for="JwtToken" type="hidden"/>
            <input asp-for="ServerUrl" value="@Model?.ServerUrl" placeholder="TeamCity URL" type="text" class="text medium-field">
            @for (var i = 0; i < 5; i++)
            {
                <div>
                    <input asp-for="@Model.BuildConfigurations[i].BuildConfigurationIds" value="@Model?.BuildConfigurations[i].BuildConfigurationIds" placeholder="buildExternalTypeId separated with comma" type="text" class="text medium-field">
                    <input asp-for="@Model.BuildConfigurations[i].MaxWaitDurationInMinutes" value="@Model?.BuildConfigurations[i].MaxWaitDurationInMinutes" placeholder="Max duration in minutes" type="text" class="text medium-field">
                </div>
            }
        </div>
        <div class="buttons">
            <input id="sendConfig" class="aui-button-primary aui-button save-glance-config submit" type="submit" value="Save">
        </div>
    </form>

    <script language="javascript">

        $(document).ready(function() {
            HipChat.auth.withToken(function(err, token) {
                $('input[name="JwtToken"]').val(token);
            });
        });

    </script>
</div>
</body>
</html>